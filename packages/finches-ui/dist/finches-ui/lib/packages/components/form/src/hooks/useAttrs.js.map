{"version":3,"file":"useAttrs.js","sources":["../../../../../../../../../components/form/src/hooks/useAttrs.ts"],"sourcesContent":["/*\n * @Description:\n * @Author: 华松林\n * @Date: 2021-08-23 15:15:14\n * @LastEditors: 华松林\n * @LastEditTime: 2021-12-01 10:55:26\n * @FilePath: /finches-ui/packages/components/form/src/hooks/useAttrs.ts\n */\nimport { getCurrentInstance, reactive, shallowRef, watchEffect } from 'vue'\nimport type { Ref } from 'vue'\ninterface Params {\n  excludeListeners?: boolean\n  excludeKeys?: string[]\n}\n\nconst DEFAULT_EXCLUDE_KEYS = ['class', 'style']\nconst LISTENER_PREFIX = /^on[A-Z]/\n\n// eslint-disable-next-line no-undef\nexport function entries<T>(obj: any): [string, T][] {\n  return Object.keys(obj).map((key: string) => [key, obj[key]])\n}\n\n// eslint-disable-next-line no-undef\n// eslint-disable-next-line @typescript-eslint/ban-types\nexport function useAttrs(params: Params = {}): Ref<any> | {} {\n  const instance = getCurrentInstance()\n  if (!instance) return {}\n\n  const { excludeListeners = false, excludeKeys = [] } = params\n  const attrs = shallowRef({})\n  const allExcludeKeys = excludeKeys.concat(DEFAULT_EXCLUDE_KEYS)\n\n  // Since attrs are not reactive, make it reactive instead of doing in `onUpdated` hook for better performance\n  instance.attrs = reactive(instance.attrs)\n\n  watchEffect(() => {\n    const res = entries(instance.attrs).reduce((acm, [key, val]) => {\n      if (\n        !allExcludeKeys.includes(key) &&\n        !(excludeListeners && LISTENER_PREFIX.test(key))\n      ) {\n        acm[key] = val\n      }\n\n      return acm\n      // eslint-disable-next-line no-undef\n    }, {})\n\n    attrs.value = res\n  })\n\n  return attrs\n}\n"],"names":["getCurrentInstance","shallowRef","reactive"],"mappings":";;;;;;AAeA,MAAM,uBAAuB,CAAC,SAAS;AACvC,MAAM,kBAAkB;iBAGG,KAAyB;AAClD,SAAO,OAAO,KAAK,KAAK,IAAI,CAAC,QAAgB,CAAC,KAAK,IAAI;AAAA;kBAKhC,SAAiB,IAAmB;AAC3D,QAAM,WAAWA;AACjB,MAAI,CAAC;AAAU,WAAO;AAEtB,QAAM,EAAE,mBAAmB,OAAO,cAAc,OAAO;AACvD,QAAM,QAAQC,eAAW;AACzB,QAAM,iBAAiB,YAAY,OAAO;AAG1C,WAAS,QAAQC,aAAS,SAAS;AAEnC,kBAAY,MAAM;AAChB,UAAM,MAAM,QAAQ,SAAS,OAAO,OAAO,CAAC,KAAK,CAAC,KAAK,SAAS;AAC9D,UACE,CAAC,eAAe,SAAS,QACzB,sBAAsB,gBAAgB,KAAK,OAC3C;AACA,YAAI,OAAO;AAAA;AAGb,aAAO;AAAA,OAEN;AAEH,UAAM,QAAQ;AAAA;AAGhB,SAAO;AAAA;;;;;"}