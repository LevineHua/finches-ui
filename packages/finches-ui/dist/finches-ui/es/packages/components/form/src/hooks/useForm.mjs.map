{"version":3,"file":"useForm.mjs","sources":["../../../../../../../../../components/form/src/hooks/useForm.ts"],"sourcesContent":["/*\n * @Description:\n * @Author: 华松林\n * @Date: 2021-08-11 17:46:48\n * @LastEditors: 华松林\n * @LastEditTime: 2021-11-30 17:15:11\n * @FilePath: /finches-ui/packages/components/form/src/hooks/useForm.ts\n */\nimport { nextTick, ref, unref, watch } from 'vue'\nimport { getDynamicProps } from '@finches-ui/utils/index'\n\nexport function useForm(props: any) {\n  const fromRef = ref(null)\n  const loadedRef = ref(false)\n\n  async function getForm() {\n    const form = unref(fromRef)\n    // if (!form) {\n    //   console.error(\n    //     'The form instance has not been obtained, please make sure that the form has been rendered when performing the form operation!'\n    //   )\n    // }\n    await nextTick()\n    return form as any\n  }\n\n  function register(instance: any) {\n    if (unref(loadedRef) && instance === unref(fromRef)) return\n\n    fromRef.value = instance\n    loadedRef.value = true\n\n    watch(\n      () => props,\n      () => {\n        props && instance.setProps(getDynamicProps(props))\n      },\n      {\n        immediate: true,\n        deep: true,\n      }\n    )\n  }\n\n  const methods: any = {\n    setProps: async (formProps: any): Promise<any> => {\n      const form = await getForm()\n      form.setProps(formProps)\n    },\n    validate: async (nameList: any): Promise<any> => {\n      const form = await getForm()\n      return form.validate(nameList)\n    },\n    setFieldsValue: async <T>(values: T): Promise<any> => {\n      const form = await getForm()\n      return form.setFieldsValue(values)\n    },\n    submit: async (): Promise<any> => {\n      const form = await getForm()\n      return form.submit()\n    },\n    getAllFieldsValue: async (): Promise<any> => {\n      const form = await getForm()\n      return form?.getAllFieldsValue()\n    },\n    clearValidate: async (name?: string | string[]) => {\n      const form = await getForm()\n      form.clearValidate(name)\n    },\n  }\n\n  return [register, methods]\n}\n"],"names":[],"mappings":";;;iBAWwB,OAAY;AAClC,QAAM,UAAU,IAAI;AACpB,QAAM,YAAY,IAAI;AAEtB,2BAAyB;AACvB,UAAM,OAAO,MAAM;AAMnB,UAAM;AACN,WAAO;AAAA;AAGT,oBAAkB,UAAe;AAC/B,QAAI,MAAM,cAAc,aAAa,MAAM;AAAU;AAErD,YAAQ,QAAQ;AAChB,cAAU,QAAQ;AAElB,UACE,MAAM,OACN,MAAM;AACJ,eAAS,SAAS,SAAS,gBAAgB;AAAA,OAE7C;AAAA,MACE,WAAW;AAAA,MACX,MAAM;AAAA;AAAA;AAKZ,QAAM,UAAe;AAAA,IACnB,UAAU,OAAO,cAAiC;AAChD,YAAM,OAAO,MAAM;AACnB,WAAK,SAAS;AAAA;AAAA,IAEhB,UAAU,OAAO,aAAgC;AAC/C,YAAM,OAAO,MAAM;AACnB,aAAO,KAAK,SAAS;AAAA;AAAA,IAEvB,gBAAgB,OAAU,WAA4B;AACpD,YAAM,OAAO,MAAM;AACnB,aAAO,KAAK,eAAe;AAAA;AAAA,IAE7B,QAAQ,YAA0B;AAChC,YAAM,OAAO,MAAM;AACnB,aAAO,KAAK;AAAA;AAAA,IAEd,mBAAmB,YAA0B;AAC3C,YAAM,OAAO,MAAM;AACnB,aAAO,6BAAM;AAAA;AAAA,IAEf,eAAe,OAAO,SAA6B;AACjD,YAAM,OAAO,MAAM;AACnB,WAAK,cAAc;AAAA;AAAA;AAIvB,SAAO,CAAC,UAAU;AAAA;;;;"}